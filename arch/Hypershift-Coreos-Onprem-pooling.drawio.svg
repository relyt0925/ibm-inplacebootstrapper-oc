<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="3161px" height="1601px" viewBox="-0.5 -0.5 3161 1601" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-12-20T20:29:41.658Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36&quot; etag=&quot;pylYGFMfQVVGxotjCwdb&quot; version=&quot;16.0.0&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;lC0TxrPUCZfqNEOtvvyH&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="1330" y="1150" width="520" height="450" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 518px; height: 1px; padding-top: 1375px; margin-left: 1331px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">RHCOS NODE<br /><br /><div style="text-align: left"><span>1) Retrieve machine-config-daemon (or have it in image)</span></div><div style="text-align: left"><span><br /></span></div><div style="text-align: left">2) When ignition data downloaded, parse out file <span style="background-color: rgba(29 , 28 , 29 , 0.04) ; color: rgb(224 , 30 , 90) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace">/etc/mcs-machine-config-content.json </span><span>and place the data at file </span><span> </span><span style="background-color: rgba(29 , 28 , 29 , 0.04) ; color: rgb(224 , 30 , 90) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace">/etc/ignition-machine-config-encapsulated.json</span></div><div style="text-align: left"><span style="background-color: rgba(29 , 28 , 29 , 0.04) ; color: rgb(224 , 30 , 90) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace"><br /></span></div><div style="text-align: left">3) Parse out file data for <b>/etc/kubernetes/kubeconfig and </b><span>/</span><b>etc/machine-config-daemon/node-annotations.json </b><span>and add to ignition-machine-config-encapsulated.json (need to properly do json merge to add two files).</span></div><div style="text-align: left"><span style="background-color: rgba(29 , 28 , 29 , 0.04) ; color: rgb(224 , 30 , 90) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace"><br /></span></div><div style="text-align: left">3) Run <span style="background-color: rgba(29 , 28 , 29 , 0.04) ; color: rgb(224 , 30 , 90) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace">machine-config-daemon firstboot-complete-machineconfig</span></div><div style="text-align: left"><span style="background-color: rgba(29 , 28 , 29 , 0.04) ; color: rgb(224 , 30 , 90) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace"><br /></span></div><div style="text-align: left"><div>4) Node serializes config and reboots, on next boot joins cluster appropriately (IBM Cloud components in this case need to handle CSR approval based on registration system)</div><div><br /></div><div><br /></div><div>Note in process:<br />Is it possible to relax "one ssh key" check? https://github.com/openshift/machine-config-operator/blob/d4dc34299e409010592d6c5d3d9bbbcdd572e2ac/pkg/daemon/update.go#L859<br /><br /></div></div></div></div></div></foreignObject><text x="1590" y="1379" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">RHCOS NODE...</text></switch></g><path d="M 1170 1180 L 1325.96 1370.08" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1329.29 1374.14 L 1322.14 1370.94 L 1325.96 1370.08 L 1327.56 1366.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="960" width="1160" height="560" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1158px; height: 1px; padding-top: 1240px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Host attach userdata (contains script)<br /><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal"><span class="s1"><font face="menlo"><span style="font-size: 11px"><br /></span></font></span></p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal"></p><div style="text-align: left"><span style="font-size: 11px ; font-family: &quot;menlo&quot;">1) Download userdata with `ibmcloud sat host attach`</span></div><div style="text-align: left"><span style="font-size: 11px ; font-family: &quot;menlo&quot;"><br /></span></div><div style="text-align: left"><span style="font-size: 11px ; font-family: &quot;menlo&quot;"><br /></span></div><div style="text-align: left"><font face="menlo"><span style="font-size: 11px">Example data (contains script and systemd unit to execute it)</span></font></div><p></p><div style="text-align: left">{</div><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal"><span class="s1"></span></p><div style="text-align: left"><font face="menlo"><span style="font-size: 11px"><div>  "ignition": {</div><div>    "version": "3.1.0"</div><div>  },</div><div>  "passwd": {</div><div>    "users": [</div><div>      {</div><div>        "name": "core"</div><div>      }</div><div>    ]</div><div>  },</div><div>  "storage": {</div><div>    "files": [</div><div>      {</div><div>        "overwrite": true,</div><div>        "path": "/usr/local/bin/ibm-host-attach.sh",</div><div>        "contents": {</div><div>          "source": "data:text/plain;charset=utf-8;base64,IyEvdXNyL2Jpbi9lbnYgYmFzaApzZXQgLXgKaXAgYWRkciBkZWxldGUgMTcyLjIwLjAuMS8zMiBkZXYgbG8KaXAgcm91dGUgZGVsIDE3Mi4yMC4wLjEvMzIgZGV2IGxvIHNjb3BlIGxpbmsgc3JjIDE3Mi4yMC4wLjEK"</div><div>        },</div><div>        "mode": 493</div><div>      }</div><div>    ]</div><div>  },</div><div>  "systemd": {</div><div>    "units": [</div><div>      {</div><div>        "contents": "[Unit]\nDescription=IBM Host Attach Service\nAfter=After=network.target\n\n[Service]\nEnvironment=\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n\nExecStart=/usr/local/bin/ibm-host-attach.sh\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n\n\n",</div><div>        "enabled": true,</div><div>        "name": "ibm-host-attach.service"</div><div>      }</div><div>    ]</div><div>  }</div><div>}</div></span></font></div></div></div></div></foreignObject><text x="580" y="1244" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Host attach userdata (contains script)...</text></switch></g><path d="M 1330 1150 L 1199.97 748.04" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1198.35 743.04 L 1203.84 748.63 L 1199.97 748.04 L 1197.18 750.78 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="950" y="770" width="270" height="150" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 845px; margin-left: 952px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="text-align: center"><span>Node registers to IBM through host attach script</span></div><div><br /></div><div>cat &lt;&lt;EOF &gt;register.json</div><div>{</div><div>"controller": "$CONTROLLER_ID",</div><div>"name": "$HOSTNAME",</div><div>"identifier": "$MACHINE_ID",</div><div>"labels": $SELECTOR_LABELS</div><div>}</div><div>EOF</div></div></div></div></foreignObject><text x="952" y="849" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Node registers to IBM through host attach scr...</text></switch></g><ellipse cx="1190" cy="695" rx="45" ry="45" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 695px; margin-left: 1146px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">IBM APIs</div></div></div></foreignObject><text x="1190" y="699" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">IBM APIs</text></switch></g><path d="M 1235 695 L 1516.62 1144.6" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1519.41 1149.05 L 1512.72 1144.98 L 1516.62 1144.6 L 1518.66 1141.26 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="650" y="610" width="130" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 625px; margin-left: 715px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Runs <br />ibmcloud host assign</div></div></div></foreignObject><text x="715" y="629" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Runs...</text></switch></g><ellipse cx="635" cy="587.5" rx="7.5" ry="7.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><path d="M 635 595 L 635 620 M 635 600 L 620 600 M 635 600 L 650 600 M 635 620 L 620 640 M 635 620 L 650 640" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 647px; margin-left: 635px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Actor</div></div></div></foreignObject><text x="635" y="659" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Actor</text></switch></g><path d="M 1200 650 L 1863.85 471.65" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1868.92 470.29 L 1863.07 475.49 L 1863.85 471.65 L 1861.25 468.73 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1870" y="440" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 470px; margin-left: 1871px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Hypershift cluster/metadata </div></div></div></foreignObject><text x="1930" y="474" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Hypershift cluster/m...</text></switch></g><rect x="820" y="350" width="1025" height="120" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1023px; height: 1px; padding-top: 410px; margin-left: 821px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Downloads userdata associated with nodepool (latest config) and sends that back to user<br /><br />User uses this to download rendered-master-*.yaml which contains the fully rendered machine config object (need different route than /ignition<br /><br /><p class="p1" style="margin: 0px ; font-stretch: normal ; font-size: 11px ; line-height: normal ; font-family: &quot;menlo&quot;"><span class="s1">{"ignition":{"config":{"merge":[{"httpHeaders":[{"name":"Authorization","value":"Bearer ZDI5MWFkZGYtNmUwOC00M2EwLTk0N2UtM2UxZWY2MjU3MDgx"}],"source":"https://bts-oc4-rhcos-prtes-15b0bf3714b2d9d344c3b8647edb7860-0000.us-south.stg.containers.appdomain.cloud:32239/ignition","verification":{}}],"replace":{"verification":{}}},"proxy":{},"security":{"tls":{"certificateAuthorities":[{"source":"data:text/plain;base64,CACA","verification":{}}]}},"timeouts":{},"version":"3.1.0"},"passwd":{},"storage":{},"systemd":{}}</span></p></div></div></div></foreignObject><text x="1333" y="414" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Downloads userdata associated with nodepool (latest config) and sends that back to user...</text></switch></g><path d="M 784.94 636.01 L 1136.72 688.04" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1141.91 688.81 L 1134.48 691.24 L 1136.72 688.04 L 1135.5 684.32 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="2220" y="0" width="390" height="220" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 388px; height: 1px; padding-top: 110px; margin-left: 2221px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Ignition Server<br /><br /><div><div style="box-sizing: inherit ; margin-left: 32px ; padding: 0px 8px ; position: relative"><div style="text-align: left ; background-color: rgb(255 , 255 , 255) ; color: rgb(29 , 28 , 29) ; font-family: &quot;monaco&quot; , &quot;menlo&quot; , &quot;consolas&quot; , &quot;courier new&quot; , monospace ; font-size: 13px"><br /></div></div></div></div></div></div></foreignObject><text x="2415" y="114" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Ignition Server...</text></switch></g><rect x="1370" y="820" width="150" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 860px; margin-left: 1371px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Parses the user data returned and calls out to download ignition data</div></div></div></foreignObject><text x="1445" y="864" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Parses the user data retu...</text></switch></g><path d="M 1852.83 1144.3 L 2309.6 224.82" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1850.5 1149 L 1850.48 1141.17 L 1852.83 1144.3 L 1856.75 1144.29 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 2311.93 220.12 L 2311.95 227.95 L 2309.6 224.82 L 2305.68 224.83 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="3100" cy="960" rx="60" ry="40" fill="none" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 960px; margin-left: 3041px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Internal Satellite Microservice (polling for proper bootstrap completion)</div></div></div></foreignObject><text x="3100" y="964" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Internal Satellite M...</text></switch></g><path d="M 1850 1262.5 L 2485.72 1042.09" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2490.68 1040.37 L 2485.21 1045.97 L 2485.72 1042.09 L 2482.92 1039.35 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="2480" y="1010" width="110" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 1025px; margin-left: 2481px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Creates CSRs</div></div></div></foreignObject><text x="2535" y="1029" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Creates CSRs</text></switch></g><path d="M 3040 960 L 2596.33 1009.3" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2591.11 1009.88 L 2597.68 1005.62 L 2596.33 1009.3 L 2598.45 1012.58 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 1850 1375 L 2464.01 1152.17" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2468.95 1150.38 L 2463.56 1156.06 L 2464.01 1152.17 L 2461.17 1149.48 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="2470" y="1130" width="110" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 1145px; margin-left: 2471px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Node joins cluster</div></div></div></foreignObject><text x="2525" y="1149" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Node joins cluster</text></switch></g><path d="M 3100 1000 L 2586.13 1143.29" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2581.08 1144.7 L 2586.88 1139.45 L 2586.13 1143.29 L 2588.76 1146.19 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="2790" y="1090" width="280" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1100px; margin-left: 2930px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Labels/Taints node based on user supplied taints</div></div></div></foreignObject><text x="2930" y="1104" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Labels/Taints node based on user supplied tain...</text></switch></g><rect x="2290" y="270" width="630" height="620" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 628px; height: 1px; padding-top: 277px; margin-left: 2292px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>Key data that is returned (kubeconfig and node-annotations.json not included in machine content payload)</div><div>{</div><div>  "ignition": {</div><div>    "version": "3.1.0"</div><div>  },</div><div>  "passwd": {</div><div>    "users": [</div><div>      {</div><div>        "name": "core"</div><div>      }</div><div>    ]</div><div>  },</div><div>  "storage": {</div><div>    "files": [</div><div>      {</div><div>        "overwrite": true,</div><div>        "path": "<b>/etc/mcs-machine-config-content.json</b>",</div><div>        "contents": {</div><div>          "source": "data:,URLENCODEDAWESOMEDATA"</div><div>        },</div><div>        "mode": 420</div><div>      },</div><div>      {</div><div>        "overwrite": true,</div><div>        "path": "/<b>etc/machine-config-daemon/node-annotations.json</b>",</div><div>        "contents": {</div><div>          "source": "data:,%7B%22machineconfiguration.openshift.io%2FcurrentConfig%22%3A%22rendered-master-a14c8811810bf0d531c9f8c41ee8800c%22%2C%22machineconfiguration.openshift.io%2FdesiredConfig%22%3A%22rendered-master-a14c8811810bf0d531c9f8c41ee8800c%22%2C%22machineconfiguration.openshift.io%2Fstate%22%3A%22Done%22%7D"</div><div>        },</div><div>        "mode": 420</div><div>      },</div><div>      {</div><div>        "overwrite": true,</div><div>        "path": "/<b>etc/kubernetes/kubeconfig</b>",</div><div>        "contents": {</div><div>          "source": "data:,URLENCODEDAWESOMEDATA"</div><div>        },</div><div>        "mode": 420</div><div>      }</div><div>   ]</div><div> }</div><div>}</div></div></div></div></foreignObject><text x="2292" y="289" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Key data that is returned (kubeconfig and node-annotations.json not included in machine content payload)...</text></switch></g><rect x="2600" y="910" width="400" height="60" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 398px; height: 1px; padding-top: 917px; margin-left: 2601px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><span>approves based on it containing proper node name AND that</span><br /><span>it is either kubelet-serving or kubelet-client. Needs to do this because it knows when nodes are joining and the proper metadata about node (there will be no Machines)</span></div></div></div></foreignObject><text x="2800" y="929" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">approves based on it containing proper node name AND that...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>